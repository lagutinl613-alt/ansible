- name: Ban IP on all servers
  hosts: all
  become: true
  vars:
    ban_ip: "1.2.3.4"
    ban_time: 3600
  tasks:
    - name: Ensure banlist exists with desired timeout
      command: ipset create banlist hash:ip timeout {{ ban_time }} -exist

    - name: Add IP with timeout (auto-expires)
      command: ipset add banlist {{ ban_ip }} timeout {{ ban_time }} -exist
